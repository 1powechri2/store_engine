<h1>Orders</h1>
<br />
<br />

<h4>Sort by Status</h4>
<%= link_to "All Orders: ", admin_report_orders_path %> <%= Order.all.count %>
<%= link_to "Pending: ", admin_report_orders_path(:filter => "pending") %> <%= Order.count_status("pending") %>
<%= link_to "Shipped: ", admin_report_orders_path(:filter => "shipped") %> <%= Order.count_status("shipped") %>
<%= link_to "Paid: ", admin_report_orders_path(:filter => "paid") %> <%= Order.count_status("paid") %>
<%= link_to "Returned: ", admin_report_orders_path(:filter => "returned") %> <%= Order.count_status("returned") %>
<%= link_to "Cancelled: ", admin_report_orders_path(:filter => "cancelled") %> <%= Order.count_status("cancelled") %>

<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>User</th>
      <th>Created at</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @orders.each do |order|%>
      <% if can? :read, order %>
        <tr>
          <td><%= link_to order.id, order_path(order) %></td>
          <td><%= order.name %></td>
          <td><%= distance_of_time_in_words_to_now(order.created_at) %></td>
          <td><%= order.status %>
            <% if can? :update, order %> 
              <% if order.next_status %>
                <%= form_for order do |f| %>
                  <%= f.hidden_field :status, :value => order.next_status %>
                  <%= f.submit "mark as #{order.next_status}" %>
                <% end %>
              <% end %> 
            <% end %>
          </td>
          <td>
            <%= link_to 'Edit', edit_order_path(order), :class => 'btn btn-mini' %>
            <%= link_to 'Destroy', order_path(order), :method => :delete, :confirm => 'Are you sure?', :class => 'btn btn-mini btn-danger' %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
