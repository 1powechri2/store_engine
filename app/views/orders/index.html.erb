<h1>Orders</h1>
<!-- Pending: <%= Order.status_hash["pending"] %>
Shipped: <%= Order.status_hash["shipped"] %>
Paid: <%= Order.status_hash["paidd"] %>
Returned: <%= Order.status_hash["returned"] %>
Cancelled: <%= Order.status_hash["cancelled"] %> -->


<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>User</th>
      <th>Created at</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @orders.each do |order|%>
      <% if can? :read, order %>
        <tr>
          <td><%= link_to order.id, order_path(order) %></td>
          <td><%= order.name %></td>
          <td><%= distance_of_time_in_words_to_now(order.created_at) %></td>
          <td><%= order.status %>
            <% if can? :update, order %> 
              <% if order.next_status %>
                <%= form_for order do |f| %>
                  <%= f.hidden_field :status, :value => order.next_status %>
                  <%= f.submit "mark as #{order.next_status}" %>
                <% end %>
              <% end %> 
            <% end %>
          </td>
          <td>
            <%= link_to 'Edit', edit_order_path(order), :class => 'btn btn-mini' %>
            <%= link_to 'Destroy', order_path(order), :method => :delete, :confirm => 'Are you sure?', :class => 'btn btn-mini btn-danger' %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>

<%= link_to 'New', new_order_path, :class => 'btn btn-primary' %>
